# ITK Report Structure

This document describes the structure of test report artifacts generated by ITK.

## Report Artifacts Overview

When you run `itk run --case <path> --out <dir>`, the following artifacts are generated:

```
<out-dir>/
â”œâ”€â”€ trace-viewer.html    â† Interactive sequence diagram viewer
â”œâ”€â”€ timeline.html        â† Waterfall timeline visualization  
â”œâ”€â”€ sequence.html        â† Legacy Mermaid-rendered diagram
â”œâ”€â”€ sequence.mmd         â† Mermaid diagram source
â”œâ”€â”€ report.md            â† Markdown summary with invariant results
â”œâ”€â”€ spans.jsonl          â† Raw span data (one JSON object per line)
â”œâ”€â”€ thumbnail.svg        â† Mini preview of sequence flow
â”œâ”€â”€ timeline-thumbnail.svg
â””â”€â”€ payloads/
    â”œâ”€â”€ span-001.request.json
    â”œâ”€â”€ span-001.response.json
    â”œâ”€â”€ span-002.request.json
    â””â”€â”€ ...
```

---

## trace-viewer.html â€” Interactive Sequence Diagram

**Primary visualization for exploring trace data.**

### Layout

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Trace Viewer â€” <case-id>              [ğŸ” Search] [ğŸ”´ Errors] [ğŸ”„ Retries] ğŸŒ™ â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                              â”‚ Span Details  â”‚
â”‚                   SVG Sequence Diagram                       â”‚               â”‚
â”‚                                                              â”‚ Operation:    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚ Component:    â”‚
â”‚  â”‚ entrypoint â”‚    â”‚  agent   â”‚    â”‚  lambda  â”‚              â”‚ Span ID:      â”‚
â”‚  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜              â”‚ Latency:      â”‚
â”‚       â”‚                â”‚                â”‚                    â”‚ Status: âœ…    â”‚
â”‚       â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º â”‚                â”‚                    â”‚               â”‚
â”‚       â”‚â—„ - - - - - - - â”‚                â”‚                    â”‚ Request:      â”‚
â”‚       â”‚                â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º â”‚                    â”‚ { ... }       â”‚
â”‚       â”‚                â”‚â—„ - - - - - - - â”‚                    â”‚               â”‚
â”‚                                                              â”‚ Response:     â”‚
â”‚  [+] [-] [âŠ¡] [â†º]    Keyboard: / search  Esc clear  â†‘â†“ nav   â”‚ { ... }       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Spans: 3  â”‚  Participants: 3  â”‚  Errors: 0  â”‚  Retries: 0                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Features

| Feature | Description |
|---------|-------------|
| **Pan & Zoom** | Mouse wheel to zoom, drag to pan. Buttons: +, -, fit, reset |
| **Search** | Press `/` to focus. Fuzzy search by operation, component, span ID |
| **Filters** | ğŸ”´ Errors â€” show only error spans. ğŸ”„ Retries â€” show only retries |
| **Click Span** | Opens details panel on right with full request/response JSON |
| **Copy Payload** | Click ğŸ“‹ button to copy JSON to clipboard |
| **Keyboard Nav** | `â†‘`/`â†“` to navigate spans, `Esc` to clear selection |
| **Dark Mode** | Click ğŸŒ™ to toggle dark theme |

### Sequence Diagram Elements

| Element | Meaning |
|---------|---------|
| **Solid arrow â†’** | Call (request sent) |
| **Dashed arrow â†** | Return (response received) |
| **Green âœ…** | Successful span |
| **Red âŒ** | Error span |
| **Yellow badge** | Retry attempt (attempt > 1) |
| **Activation box** | Duration of span on callee's lifeline |

---

## timeline.html â€” Waterfall Timeline

**Shows spans as horizontal bars on a time axis.**

### Layout

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Timeline â€” <case-id>                                     [Export] ğŸŒ™   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                         â”‚
â”‚  Component          0ms     100ms    200ms    300ms    400ms    500ms   â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚  entrypoint:sqs     â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ  â”‚
â”‚  agent:gatekeeper          â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ             â”‚
â”‚  lambda:action                      â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ                      â”‚
â”‚                                                                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Selected: span-002  â”‚  Duration: 150ms  â”‚  Status: Success             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Features

- **Proportional bars**: Width proportional to span duration
- **Color coding**: Each component type has a distinct color
- **Critical path**: Longest path highlighted in yellow outline
- **Hover details**: Duration and status on hover
- **Dark mode**: Click ğŸŒ™ to toggle

---

## report.md â€” Markdown Summary

**Human-readable summary for quick review.**

### Contents

```markdown
# ITK Run Report

## Case
- **ID**: example-001
- **Name**: Example SQS-shaped entrypoint
- **Entrypoint**: sqs_event

## Summary
- **Spans**: 3
- **Components**: 3

## Invariants
- âœ… PASS `has_spans` (count: 3)
- âœ… PASS `no_duplicate_span_ids`
- âœ… PASS `has_entrypoint` (root_count: 1)
- âœ… PASS `no_orphan_spans`
- âœ… PASS `valid_timestamps`
- âœ… PASS `max_retry_count` (max_allowed: 5)

## Spans
| Span ID | Component | Operation | Has Request | Has Response |
|---------|-----------|-----------|-------------|--------------|
| span-001 | entrypoint:sqs_event | InvokeLambda | âœ… | âœ… |
| ... | ... | ... | ... | ... |
```

---

## sequence.mmd â€” Mermaid Source

**Portable diagram source for embedding in docs/PRs.**

```mermaid
sequenceDiagram
    participant entrypoint_sqs_event as entrypoint:sqs_event
    participant agent_gatekeeper as agent:gatekeeper
    
    entrypoint_sqs_event->>agent_gatekeeper: InvokeAgent [attempt 1]
    Note over entrypoint_sqs_event,agent_gatekeeper: req=payloads/span-002.request.json
```

Can be rendered in:
- GitHub PR descriptions and comments
- VS Code Markdown preview (with Mermaid extension)
- Any Mermaid-compatible tool

---

## payloads/ â€” Request/Response JSON

**Individual JSON files for each span's request and response.**

```
payloads/
â”œâ”€â”€ span-001.request.json    â† Request payload for span-001
â”œâ”€â”€ span-001.response.json   â† Response payload for span-001
â”œâ”€â”€ span-002.request.json
â”œâ”€â”€ span-002.response.json
â”œâ”€â”€ span-003.error.json      â† Error payload (if span errored)
â””â”€â”€ ...
```

**Why separate files?**
- Large payloads don't bloat the main report
- Easy to diff between runs
- Can be committed to version control for baseline comparison

---

## Suite Report (index.html)

When running `itk suite --cases-dir <dir> --out <dir>`, generates:

```
<out-dir>/
â”œâ”€â”€ index.html          â† Suite summary with all cases
â”œâ”€â”€ index.json          â† Machine-readable summary
â”œâ”€â”€ case-001/
â”‚   â”œâ”€â”€ trace-viewer.html
â”‚   â””â”€â”€ ...
â”œâ”€â”€ case-002/
â”‚   â””â”€â”€ ...
â””â”€â”€ ...
```

### index.html Layout

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ITK Suite Report                                     Run: 2026-01-15   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                         â”‚
â”‚  Summary: 10 passed, 2 failed, 12 total                                 â”‚
â”‚                                                                         â”‚
â”‚  Case         Status    Duration   Spans   Errors   Preview            â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚  example-001  âœ… PASS   1.2s       3       0        [mini-diagram]      â”‚
â”‚  example-002  âœ… PASS   0.8s       2       0        [mini-diagram]      â”‚
â”‚  example-003  âŒ FAIL   2.1s       5       1        [mini-diagram]      â”‚
â”‚                                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

Click any row to open the full `trace-viewer.html` for that case.

---

## Opening Reports

All reports work via `file://` protocol â€” no server required.

```bash
# Windows
start artifacts/demo-run/trace-viewer.html

# macOS
open artifacts/demo-run/trace-viewer.html

# Linux
xdg-open artifacts/demo-run/trace-viewer.html
```

Or use the ITK serve command for live preview:
```bash
itk serve --dir artifacts/demo-run --port 8080
```
